<?php
/*
<html> 
<head> 
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
<title>Google Maps JavaScript API v3 Example: Common Loader</title>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
*/
?>
<script type="text/javascript" src="modules/googlemap/util.js"></script>


<?php 
/*
?> 

<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/redmond/jquery-ui.css" rel="stylesheet" type="text/css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>

<?php 
*/
?>

<script type="text/javascript"> 
  	var infowindow;
  	var map;
  	
   	var win = "pano"; 
   
	function loadMap() {	
	}

	// function loadMap() {
	
	jQuery(function() {
	
    	var myLatlng = new google.maps.LatLng(0, 0);
    	var myOptions = {
      	zoom: 10,
      	center: myLatlng,
      	mapTypeId: google.maps.MapTypeId.ROADMAP
      	//streetViewControl: true
    	}
 
    	map = new google.maps.Map(document.getElementById("map_pane"), myOptions);	
    	
    	downloadUrl("modules/googlemap/categories.xml", function(data) {
      		var markers = data.documentElement.getElementsByTagName("marker");
      		var propName;
      		var propAddress;
      		var propCity;
      		var propState;
      		var propService;
      		var propType;
      		var propSF;
 
      		//creates a variable used to hold the outer dimensions of map
      		var bounds = new google.maps.LatLngBounds();
      		
      		//read data
      		for (var r = 0; r < markers.length; r++) {
        		var latlng = new google.maps.LatLng(parseFloat(markers[r].getAttribute("lat")), parseFloat(markers[r].getAttribute("lng")));

        		propName=markers[r].getAttribute("name");
        		propAddress=markers[r].getAttribute("address");  
        		propService=markers[r].getAttribute("category");
        
      			/* 
        		propName=markers[i].getAttribute("propName");
        		propAddress=markers[i].getAttribute("propAddress");
        		propCity=markers[i].getAttribute("propCity");
        		propState=markers[i].getAttribute("propState");
        		propService=markers[i].getAttribute("propService");
        		propType=markers[i].getAttribute("propType");
        		propSF=markers[i].getAttribute("propSF");
        		propTeam=markers[i].getAttribute("propTeam"); 
				*/  
		
        		//define which icon is to be used
        		var icon;
        		if (propService=="theatre") {
        			icon = "modules/googlemap/images/icon1.png";
        		} else if (propService=="golf") {
        			icon = "modules/googlemap/images/icon3.png";
        		} else {
        			icon = "modules/googlemap/images/icon4.png";
        		}
        		
        		//create html text for inside popup
           		var text = [
          			'<div id="gmtabs">',
          				'<div class="tabs">',
          					'<ul >',
          						'<li><a href="ui-tabs-1" id="EV">Events<\/a><\/li>',
          						'<li><a href="ui-tabs-2" id="SV">Street View<\/a><\/li>',
          					'<\/ul>',
          					'<div id="ui-tabs-1">',
          						'<div id="txt">'+propName+'<\/div>',
          						'<div id="evts">',
          							'<p>',
          								'<b>' + propName + '<\/b> - <img src="'+ icon + '" width="12px" /> (' + propService + ')<br />',
          								propAddress  + '<br />',
        								//  propCity  + ', ' + propState + '<br />',
        								//  propSF  + ' SF<br />',
        								//  'Team: ' + propTeam  + '<br />',
        							'<\/p>',
        						'<\/div>',
        					'<\/div>',
          					'<div id="ui-tabs-2" >',
          						'<div id="txt">'+propName+'<\/div>',
          						'<div id="pano"><\/div>', 
          					'<\/div>',
          				'<\/div>',
          			'<\/div>'
        		].join('');
        		
        		// create marker 			
        		var marker = createMarker(text, latlng, icon);
        		
        		//sets the zoom to show all points
        		bounds.extend(latlng);
        		map.fitBounds(bounds);
       		}
 
     	});
     	

 
	});
 
    // }
 
 
  	function createMarker(text, latlng, icon) {
    	var image = new google.maps.MarkerImage(icon,
    	// This marker is 20 pixels wide by 34 pixels tall.
    	new google.maps.Size(20, 34),
    	// The origin for this image is 0,0.
    	new google.maps.Point(0,0),
    	// The anchor for this image
    	new google.maps.Point(9, 34));
 
    	var marker = new google.maps.Marker({
    	  	position: latlng, 
    	  	map: map, 
    	  	icon:image
    	});                     
 
 
    	google.maps.event.addListener(marker, "click", function() {
    	
      		if (infowindow) {
      			infowindow.close();
      		}
        	infowindow = new google.maps.InfoWindow({
	  			content: text          		
			});
        	infowindow.open(map, marker);
        	var panoramaOptions = {
          		position: marker.position,
          		navigationControl: false,
      			linksControl: false,
   				addressControl: false,
				pov: {
					heading: 20,
					pitch: 0,
					zoom: 1.1
				}          	
        	};

      		google.maps.event.addListener(infowindow, 'domready', function() {         		
          		jQuery("#gmtabs").tabs();
          		jQuery('#SV').click(function() {
       				var panorama = new google.maps.StreetViewPanorama(document.getElementById("pano"),panoramaOptions);  
            		map.setStreetView(panorama); 
          		});         		
      		});
     		
    	});
    	
    	return marker;	
  	}    
 
</script> 


<style> 
#gmtabs {
font-size: 10px;
width:330px;
/*height: 320px; */
}

.tabs{
/* width:320px; */
/*height: 310px; */
}

#txt {
/* width:319px; */
margin-top: 0px;
margin-left: -3px;
background: #ffffcc;
text-align: center;
border: 1px solid #dddddd;
border-top: 0px solid #dddddd;
}

#pano {
/* width:324px; */
height: 230px;
/* margin-left: -6px; */
}
</style>

<?php
/*
</head> 
<body> 
  <!-- <div id="map_canvas" style="width:700px; height:600px"></div> -->
  <!-- <div id='pano' style='position: absolute: top: 40px; left: 2px; width: 380px; height:290px;'></div> --> 
</body> 
</html>

*/
?>