<?php
/*
<html> 
<head> 
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
<title>Google Maps JavaScript API v3 Example: Common Loader</title>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
*/
?>
<script type="text/javascript" src="modules/googlemap/util.js"></script>

<script type="text/javascript"> 
  	var infowindow;
  	var map;  	
   	var win = "pano"; 


	function loadMap() {
	}	

	
	//jQuery(function() {

		var BoundsZoom="";
		var BoundsCenter="";
    	var myLatlng = new google.maps.LatLng(0, 0);   	
    	
    	var myOptions = {
      		zoom: 11,
      		center: myLatlng,
			mapTypeId: google.maps.MapTypeId.TERRAIN,					// ROADMAP, SATELLITE, HYBRID, TERRAIN
			mapTypeControlOptions: {
				style: google.maps.MapTypeControlStyle.DROPDOWN_MENU 	// DEFAULT, DROPDOWN_MENU, HORIZONTAL_BAR
			},
			navigationControl: true,
      		navigationControlOptions: {
   				position: google.maps.ControlPosition.TOP_RIGHT,		// BOTTOM, BOTTOM_LEFT, LEFT, TOP, etc
   				style: google.maps.NavigationControlStyle.SMALL			// ANDROID, DEFAULT, SMALL, ZOOM_PAN
      		},
      		scrollwheel: false
      		//streetViewControl: true
    	};
 
    	map = new google.maps.Map(document.getElementById("map_pane"), myOptions);	
    	
   		// Close any infowindow when map is clicked
    	google.maps.event.addListener(map, 'click', function() {
    		
      		if (infowindow) {
      			infowindow.close();
      		}
        	// == rebuild sidebar (hidden item) ==
        	// makeSidebar();       	
    	});
    	
    	google.maps.event.addListener(map, 'tilesloaded', function() {
    		if (BoundsZoom=="") {
				BoundsZoom = map.getZoom();
			}
			if (BoundsCenter=="") {
				BoundsCenter = map.getCenter();
			}
		});
		


  		// Create the Home DIV and call the HomeControl() constructor in this DIV.
  		var homeControlDiv = document.createElement('DIV');
  		var homeControl = new HomeControl(homeControlDiv, map);
		//var Mybounds = "";
		//var MyZoom = "";
  		homeControlDiv.index = 1;
  		map.controls[google.maps.ControlPosition.TOP_RIGHT].push(homeControlDiv);    	

  		
    	// Get the marker data ==
    	downloadUrl("modules/googlemap/categories.xml", function(data) {
      		var markers = data.documentElement.getElementsByTagName("marker");
      		var propName;
      		var propAddress;
      		var propCity;
      		var propState;
      		var propService;
      		var propType;
      		var propSF;
 
      		//creates a variable used to hold the outer dimensions of map
      		var bounds = new google.maps.LatLngBounds();
      		
      		//read data
      		for (var r = 0; r < markers.length; r++) {
        		var latlng = new google.maps.LatLng(parseFloat(markers[r].getAttribute("lat")), parseFloat(markers[r].getAttribute("lng")));

        		propName=markers[r].getAttribute("name");
        		propAddress=markers[r].getAttribute("address");  
        		propService=markers[r].getAttribute("category");
        
      			/* 
        		propName=markers[i].getAttribute("propName");
        		propAddress=markers[i].getAttribute("propAddress");
        		propCity=markers[i].getAttribute("propCity");
        		propState=markers[i].getAttribute("propState");
        		propService=markers[i].getAttribute("propService");
        		propType=markers[i].getAttribute("propType");
        		propSF=markers[i].getAttribute("propSF");
        		propTeam=markers[i].getAttribute("propTeam"); 
				*/  
		
        		//define which icon is to be used
        		var icon;
        		if (propService=="theatre") {
        			icon = "modules/googlemap/images/icon1.png";
        		} else if (propService=="golf") {
        			icon = "modules/googlemap/images/icon3.png";
        		} else {
        			icon = "modules/googlemap/images/icon4.png";
        		}
        		
        		//create html text for inside popup
           		var text = [
          			'<div id="gmtabs">',
          				'<div class="tabs">',
          					'<ul >',
          						'<li><a href="#tab1" id="EV">Events<\/a><\/li>',
          						'<li><a href="#tab2" id="SV">Street View<\/a><\/li>',
          					'<\/ul>',
          					'<div id="tab1">',
          						'<div id="txt">'+propName+'<\/div>',
          						'<div id="evt1">',
          							'<p>',
          								'<b>' + propName + '<\/b> - <img src="'+ icon + '" width="12px" /> (' + propService + ')<br />',
          								propAddress  + '<br />',
        								//  propCity  + ', ' + propState + '<br />',
        								//  propSF  + ' SF<br />',
        								//  'Team: ' + propTeam  + '<br />',
        							'<\/p>',
        						'<\/div>',
          						'<div id="evt2">',
          							'<p>',
          								'<b>' + propName + '<\/b> - <img src="'+ icon + '" width="12px" /> (' + propService + ')<br />',
          								propAddress  + '<br />',
        							'<\/p>',
        						'<\/div>',
        					'<\/div>',
          					'<div id="tab2" >',
          						'<div id="txt">'+propName+'<\/div>',
          						'<div id="pano"><\/div>', 
          					'<\/div>',
          				'<\/div>',
          			'<\/div>'
        		].join('');
        		
        		// create marker 			
        		var marker = createMarker(text, latlng, icon);
        		
        		//sets the zoom to show all points
        		bounds.extend(latlng);
        		map.fitBounds(bounds);
       		}

 		MyBounds = bounds;
 		
     	});
     	
	// });
 
  	function createMarker(text, latlng, icon) {
    	var image = new google.maps.MarkerImage(icon,
    	// This marker is 20 pixels wide by 34 pixels tall.
    	new google.maps.Size(20, 34),
    	// The origin for this image is 0,0.
    	new google.maps.Point(0,0),
    	// The anchor for this image
    	new google.maps.Point(9, 34));
 
    	var marker = new google.maps.Marker({
    	  	position: latlng, 
    	  	map: map, 
    	  	icon:image
    	});                     
  
    	google.maps.event.addListener(marker, "click", function() {
    	
      		if (infowindow) {
      			infowindow.close();
      		}
        	infowindow = new google.maps.InfoWindow({
	  			content: text          		
			});
        	infowindow.open(map, marker);
        	var panoramaOptions = {
          		position: marker.position,
          		navigationControl: false,
      			linksControl: false,
   				addressControl: false,
				pov: {
					heading: 20,
					pitch: 0,
					zoom: 1.1
				}          	
        	};

      		google.maps.event.addListener(infowindow, 'domready', function() { 
          		jQuery("#gmtabs").tabs();
          		jQuery('#SV').click(function() {
       				var panorama = new google.maps.StreetViewPanorama(document.getElementById("pano"),panoramaOptions);  
            		map.setStreetView(panorama); 
          		});         		
      		});
     		
    	});
    	
    	return marker;
    	
  	} 
  	
	

	// Home control ----------------------------------------------------------------
	/* The HomeControl adds a control to the map that simply
	 * returns the user to the original map position ... loadMap() function
	 * This constructor takes the control DIV as an argument.
	 */ 
	function HomeControl(controlDiv, map) {
  		// Set CSS styles for the DIV containing the control
  		// Setting padding to 5 px will offset the control
  		// from the edge of the map
  		controlDiv.style.paddingTop = '5px';
  		controlDiv.style.paddingRight = '0px';

  		// Set CSS for the control border
  		var controlUI = document.createElement('DIV');
  		controlUI.style.backgroundColor = 'white';
  		controlUI.style.borderStyle = 'solid';
  		controlUI.style.borderWidth = '2px';
  		controlUI.style.cursor = 'pointer';
  		controlUI.style.textAlign = 'center';
  		controlUI.title = 'Click to set the map to Home';
  		controlDiv.appendChild(controlUI);

  		// Set CSS for the control interior
  		var controlText = document.createElement('DIV');
  		controlText.style.fontFamily = 'Arial,sans-serif';
  		controlText.style.fontSize = '12px';
  		controlText.style.paddingLeft = '15px';
  		controlText.style.paddingRight = '15px';
  		controlText.innerHTML = '<b><?php echo i18n::translate('Redraw map')?><\/b>';
  		controlUI.appendChild(controlText);

  		// Setup the click event listeners: simply set the map to original LatLng and Zoom
  		google.maps.event.addDomListener(controlUI, 'click', function() {
      		if (infowindow) {
      			infowindow.close();
      		}
			map.setMapTypeId(google.maps.MapTypeId.TERRAIN);
			map.setZoom(BoundsZoom);
			map.setCenter(BoundsCenter);
  		});
	}
	

	
	
</script> 


<style> 
#gmtabs {
font-size: 10px;
width:330px; 
height: 260px;
}

.tabs{
/* width:320px; */
/*height: 310px; */
}

#txt {
/* width:319px; */
margin-top: 0px;
margin-left: -3px;
background: #ffffcc;
text-align: center;
border: 1px solid #dddddd;
border-top: 0px solid #dddddd;
}

#pano {
/*width:324px; */
height: 210px;
/* margin-left: -6px; */
}
</style>

