<PGVReport access="PRIV_NONE" icon="source">
	<PGVRTitle>Fact Sources</PGVRTitle>
	<PGVRDescription>Prints a list of individuals and families with a specific source for facts</PGVRDescription>
	
	<PGVRInput name="sources" lookup="SOUR" default="S" type="text"><PGVRvar var="pgv_lang[find_sourceid]" /></PGVRInput>
	<PGVRInput name="sortby" type="select" default="BIRT:DATE" options="NAME,BIRT:DATE"><PGVRvar var="pgv_lang[sort_by]" /></PGVRInput>
	<PGVRInput name="pageSize" type="select" default="A4" options="letter,A3,A4,legal"><PGVRvar var="pgv_lang[page_size]" /></PGVRInput>
	<PGVRInput name="fonts" type="select" default="dejavusans" options="arialunicid0,dejavusans,helvetica"><PGVRvar var="pgv_lang[font]"/></PGVRInput>

	<!-- Header - required style name by the generator -->
	<PGVRStyle name="header" font="$fonts" size="18" style="b" />
	<!-- Source Title -->
	<PGVRStyle name="header2" font="$fonts" size="14" style="b" />
	<!-- Name of the List Type. INDI or FAM -->
	<PGVRStyle name="listtype" font="$fonts" size="12" style="b" />
	<!-- Page numbers text -->
	<PGVRStyle name="pagenum" font="$fonts" size="8" />
	<!-- Standard text -->
	<PGVRStyle name="text" font="$fonts" size="8" />
	<!-- Column labels -->
	<PGVRStyle name="label" font="$fonts" size="9" style="b"/>
	<!-- Generated by style - required style name by the generator -->
	<PGVRStyle name="genby" font="$fonts" size="8" />
	<!-- Date Text-->
	<PGVRStyle name="date" font="$fonts" size="8"/>

	<PGVRSetVar name="name" value="200" />
	<PGVRSetVar name="famname" value="270" />
	<PGVRSetVar name="bdate" value="120" />
	<PGVRSetVar name="fact" value="100" />
	<PGVRSetVar name="edate" value="100" />
	<PGVRSetVar name="vspace" value="5" />
	<PGVRSetVar name="listcounter" value="16" />
	<PGVRSetVar name="printedsource" value="0" />
	<PGVRSetVar name="moresourcespace" value="$name + $bdate" />
	<PGVRSetVar name="moresourcespacefam" value="$famname + $bdate" />
	<PGVRSetVar name="ignore" value="CHAN,CHIL,FAMC,FAMS,HUSB,NAME,NOTE,OBJE,SEX,SOUR,TITL,WIFE,_UID,_PGV_OBJS"/>

	<PGVRDoc pageSize="$pageSize" orientation="landscape">
		<PGVRHeader>
			<PGVRCell align="center" newline="1" style="header"><PGVRvar var="pgv_lang[source_list]" /></PGVRCell>
			<PGVRCell align="right" newline="1" style="pagenum"><PGVRvar var="pgv_lang[page]" /> <PGVRPageNum /> <PGVRvar var="pgv_lang[of]" /> <PGVRTotalPages /></PGVRCell>
			<!-- Source Title -->
			<PGVRGedcom id="$sources">
				<PGVRCell align="center" newline="1" style="header2">(<PGVRvar var="sources"/>) <PGVRGedcomValue tag="TITL" /></PGVRCell>
			</PGVRGedcom>
		</PGVRHeader>

		<PGVRBody>
			<!-- List type -->
			<PGVRCell align="center" newline="1" style="listtype"><PGVRvar var="pgv_lang[individual_list]" /></PGVRCell>
			<PGVRTextBox height="$vspace" newline="1" padding="0"/>

			<!-- Individual Name -->
			<PGVRSetVar name="fill" value="" />
			<PGVRif condition="$sortby=='NAME'">
				<PGVRSetVar name="fill" value="#DDDDDD" />
			</PGVRif>
			<PGVRTextBox bgcolor="$fill" border="1" width="$name">
				<PGVRText style="label"><PGVRvar var="pgv_lang[name]" /></PGVRText>
			</PGVRTextBox>

			<!-- Birth date -->
			<PGVRSetVar name="fill" value="" />
			<PGVRif condition="$sortby=='BIRT:DATE'">
				<PGVRSetVar name="fill" value="#DDDDDD" />
			</PGVRif>
			<PGVRTextBox bgcolor="$fill" border="1" width="$bdate">
				<PGVRText style="label"><PGVRvar var="factarray[BIRT:DATE]" /></PGVRText>
			</PGVRTextBox>

			<!-- Name of the fact that contains the source -->
			<PGVRTextBox border="1" width="$fact">
				<PGVRText style="label"><PGVRvar var="factarray[EVEN]" /></PGVRText>
			</PGVRTextBox>

			<!-- Date of the fact -->
			<PGVRTextBox border="1" width="$edate">
				<PGVRText style="label"><PGVRvar var="factarray[DATE]" /></PGVRText>
			</PGVRTextBox>

			<!-- Detailed source text -->
			<PGVRTextBox border="1" newline="1">
			  <PGVRText style="label"><PGVRvar var="factarray[SOUR]" /></PGVRText>
			</PGVRTextBox>

			<!-- Individual List -->
			<PGVRList list="individual" filter1=":SOUR CONTAINS $sources" sortby="$sortby">
				<PGVRSetVar name="moresource" value="0" />
				<PGVRSetVar name="printindi" value="0" />
				<PGVRSetVar name="printsource" value="0" />
				<!-- Filter -->
				<PGVRFacts ignore="$ignore">
					<PGVRRepeatTag tag="@fact:SOUR">
						<PGVRGedcom id="@SOUR">
							<PGVRif condition="@ID==$sources">
								<PGVRSetVar name="printindi" value="1" />
							</PGVRif>
						</PGVRGedcom>
					</PGVRRepeatTag>
				</PGVRFacts>

				<PGVRif condition="$printindi==1">
					<!-- Printed List counter -->
					<PGVRSetVar name="printedsource" value="$printedsource + 1" />

					<!-- Individual Name -->
					<PGVRTextBox width="$name">
						<PGVRText style="text"><PGVRGetPersonName id="" /> - (<PGVRGedcomValue tag="@id" />)</PGVRText>
					</PGVRTextBox>

					<!-- Birth date -->
					<PGVRTextBox width="$bdate">
						<PGVRText style="text"><PGVRGedcomValue tag="BIRT:DATE" /></PGVRText>
					</PGVRTextBox>

					<PGVRFacts ignore="$ignore">
						<PGVRSetVar name="printfact" value="0" />
						<PGVRRepeatTag tag="@fact:SOUR">
							<PGVRGedcom id="@SOUR">
								<PGVRif condition="@ID==$sources">
									<PGVRSetVar name="printfact" value="1" />
								</PGVRif>
							</PGVRGedcom>
						</PGVRRepeatTag>

						<PGVRif condition="$printfact==1">
							<PGVRSetVar name="printsource" value="0" />
							<!-- Intend the fact line if more then one fact has source -->
							<PGVRif condition="$moresource==1">
								<PGVRTextBox width="$moresourcespace"/>
							</PGVRif>

							<!-- Name of the fact that contains the source -->
							<PGVRTextBox width="$fact">
								<PGVRText style="text"><PGVRvar var="factarray[@fact]"/></PGVRText>
							</PGVRTextBox>

							<!-- Date of the fact -->
							<PGVRTextBox width="$edate">
								<PGVRText style="text"><PGVRGedcomValue tag="@fact:DATE"/></PGVRText>
							</PGVRTextBox>

							<!-- Detailed source text -->
							<PGVRTextBox newline="1">
								<PGVRText style="text">
									<PGVRRepeatTag tag="@fact:SOUR">
										<PGVRGedcom id="@SOUR">
											<PGVRif condition="@ID==$sources">
												<PGVRSetVar name="printsource" value="1" />
											</PGVRif>
										</PGVRGedcom>
										<PGVRif condition="$printsource==1">
											<PGVRGedcomValue tag="SOUR:PAGE"/>
											<PGVRif condition="@SOUR:DATA:TEXT!=''">
												<br /><PGVRGedcomValue tag="SOUR:DATA:TEXT"/>
											</PGVRif>
											<PGVRSetVar name="printsource" value="0" />
										</PGVRif>
									</PGVRRepeatTag>
								</PGVRText>
							</PGVRTextBox>
							<PGVRSetVar name="moresource" value="1" />
						</PGVRif>
						<PGVRSetVar name="printfact" value="0" />
					</PGVRFacts>
				</PGVRif>
			</PGVRList>

			<!-- Print the list counter -->
			<PGVRif condition="$printedsource==0">
				<PGVRCell align="right" height="$listcounter" newline="1" style="label"><PGVRvar var="pgv_lang[total_indis]"/>: 0</PGVRCell>
			</PGVRif>
			<PGVRif condition="$printedsource > 0">
				<PGVRCell align="right" height="$listcounter" newline="1" style="label"><PGVRvar var="pgv_lang[total_indis]"/>: <PGVRvar var="printedsource" /></PGVRCell>
			</PGVRif>


			<!-- Family List -->
			<PGVRTextBox height="$vspace" newline="1" padding="0"/>
			<PGVRCell align="center" newline="1" style="listtype"><PGVRvar var="pgv_lang[family_list]" /></PGVRCell>
			<PGVRTextBox height="$vspace" newline="1" padding="0"/>
			<!-- Family Name -->
			<PGVRTextBox border="1" width="$famname">
				<PGVRText style="label"><PGVRvar var="pgv_lang[name]" /></PGVRText>
			</PGVRTextBox>

			<!-- Name of the fact that contains the source -->
			<PGVRTextBox border="1" width="$fact">
				<PGVRText style="label"><PGVRvar var="factarray[EVEN]" /></PGVRText>
			</PGVRTextBox>

			<!-- Date of the fact -->
			<PGVRTextBox border="1" width="$edate">
				<PGVRText style="label"><PGVRvar var="factarray[DATE]" /></PGVRText>
			</PGVRTextBox>

			<!-- Detailed source text -->
			<PGVRTextBox border="1" newline="1">
			  <PGVRText style="label"><PGVRvar var="factarray[SOUR]" /></PGVRText>
			</PGVRTextBox>

			<!-- Family List -->
			<PGVRSetVar name="printedsource" value="0" />
			<PGVRList list="family" filter1=":SOUR CONTAINS $sources" sortby="MARR:DATE">
				<PGVRSetVar name="moresource" value="0" />
				<PGVRSetVar name="printfamily" value="0" />
				<PGVRSetVar name="printsource" value="0" />
				<!-- Filter -->
				<PGVRFacts ignore="$ignore">
					<PGVRRepeatTag tag="@fact:SOUR">
						<PGVRGedcom id="@SOUR">
							<PGVRif condition="@ID==$sources">
								<PGVRSetVar name="printfamily" value="1" />
							</PGVRif>
						</PGVRGedcom>
					</PGVRRepeatTag>
				</PGVRFacts>
				
				<PGVRif condition="$printfamily==1">
					<!-- Printed List counter -->
					<PGVRSetVar name="printedsource" value="$printedsource + 1" />

					<!-- Family Name -->
					<PGVRTextBox width="$famname">
						<PGVRText style="text"><PGVRGetPersonName id="" /> - (<PGVRGedcomValue tag="@id" />)</PGVRText>
					</PGVRTextBox>

					<PGVRFacts ignore="$ignore">
						<PGVRSetVar name="printfact" value="0" />
						<PGVRRepeatTag tag="@fact:SOUR">
							<PGVRGedcom id="@SOUR">
								<PGVRif condition="@ID==$sources">
									<PGVRSetVar name="printfact" value="1" />
								</PGVRif>
							</PGVRGedcom>
						</PGVRRepeatTag>

						<PGVRif condition="$printfact==1">
							<PGVRSetVar name="printsource" value="0" />
							<!-- Intend the fact line if more then one fact has source -->
							<PGVRif condition="$moresource==1">
								<PGVRTextBox width="$moresourcespacefam"/>
							</PGVRif>

							<!-- Name of the fact that contains the source -->
							<PGVRTextBox width="$fact">
								<PGVRText style="text">
									<PGVRif condition="@fact=='MARR'">
										<!-- Print different type of marriages -->
										<PGVRif condition="@MARR:TYPE==''">
											<PGVRvar var="factarray[@fact]"/>
										</PGVRif>
										<PGVRif condition="@MARR:TYPE=='Religious'">
											<PGVRvar var="factarray[MARR_RELIGIOUS]" />
										</PGVRif>
										<PGVRif condition="@MARR:TYPE=='Civil'">
											<PGVRvar var="factarray[MARR_CIVIL]" />
										</PGVRif>
										<PGVRif condition="@MARR:TYPE=='Partners'">
											<PGVRvar var="factarray[MARR_PARTNERS]" />
										</PGVRif>
									</PGVRif>
									<PGVRif condition="@fact!='MARR'">
										<PGVRvar var="factarray[@fact]"/>
									</PGVRif>
								</PGVRText>
							</PGVRTextBox>

							<!-- Date of the fact -->
							<PGVRTextBox width="$edate">
								<PGVRText style="text"><PGVRGedcomValue tag="@fact:DATE"/></PGVRText>
							</PGVRTextBox>

							<!-- Detailed source text -->
							<PGVRTextBox newline="1">
								<PGVRText style="text">
									<PGVRRepeatTag tag="@fact:SOUR">
										<PGVRGedcom id="@SOUR">
											<PGVRif condition="@ID==$sources">
												<PGVRSetVar name="printsource" value="1" />
											</PGVRif>
										</PGVRGedcom>
										<PGVRif condition="$printsource==1">
											<PGVRGedcomValue tag="SOUR:PAGE"/>
											<PGVRif condition="@SOUR:DATA:TEXT!=''">
												<br /><PGVRGedcomValue tag="SOUR:DATA:TEXT"/>
											</PGVRif>
											<PGVRSetVar name="printsource" value="0" />
										</PGVRif>
									</PGVRRepeatTag>
								</PGVRText>
							</PGVRTextBox>
							<PGVRSetVar name="moresource" value="1" />
						</PGVRif>
						<PGVRSetVar name="printfact" value="0" />
					</PGVRFacts>
				</PGVRif>
			</PGVRList>

			<!-- Print the list counter -->
			<PGVRif condition="$printedsource==0">
				<PGVRCell align="right" height="$listcounter" newline="1" style="label"><PGVRvar var="pgv_lang[total_fams]"/>: 0</PGVRCell>
			</PGVRif>
			<PGVRif condition="$printedsource > 0">
				<PGVRCell align="right" height="$listcounter" newline="1" style="label"><PGVRvar var="pgv_lang[total_fams]"/>: <PGVRvar var="printedsource" /></PGVRCell>
			</PGVRif>
		</PGVRBody>

		<PGVRFooter>
			<PGVRCell align="right" newline="1" style="date"><PGVRNow/></PGVRCell>
		</PGVRFooter>
		
	</PGVRDoc>
</PGVReport>
